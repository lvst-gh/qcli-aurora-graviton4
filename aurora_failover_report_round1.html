<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auroraåˆ‡æ¢ç›‘æ§åˆ†ææŠ¥å‘Š</title>
    <script src="https://unpkg.com/echarts@5.4.3/dist/echarts.min.js"></script>
    <script>
        if (typeof echarts === 'undefined') {
            document.write('<script src="https://cdn.staticfile.org/echarts/5.4.3/echarts.min.js"><\/script>');
        }
    </script>
    <style>
        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 15px;
        }
        h2 {
            color: #34495e;
            margin-top: 40px;
            margin-bottom: 20px;
        }
        .chart-container {
            width: 100%;
            height: 600px;
            margin: 20px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #fafafa;
        }
        .summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .summary h3 {
            color: white;
            margin-top: 0;
            margin-bottom: 20px;
        }
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        .summary-section {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #fff;
        }
        .summary-section h4 {
            margin: 0 0 10px 0;
            color: #fff;
            font-size: 16px;
        }
        .summary-section ul {
            margin: 0;
            padding-left: 20px;
        }
        .summary-section li {
            margin-bottom: 5px;
            font-size: 14px;
        }
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .metric {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .metric-value {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .metric-label {
            font-size: 14px;
            opacity: 0.9;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: bold;
            position: sticky;
            top: 0;
        }
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        tr:hover {
            background-color: #e3f2fd;
        }
        .status-success { 
            color: #27ae60; 
            font-weight: bold;
            background: #d5f4e6;
            padding: 2px 6px;
            border-radius: 3px;
        }
        .status-error { 
            color: #e74c3c; 
            font-weight: bold;
            background: #fadbd8;
            padding: 2px 6px;
            border-radius: 3px;
        }
        .status-warning { 
            color: #f39c12; 
            font-weight: bold;
            background: #fdeaa7;
            padding: 2px 6px;
            border-radius: 3px;
        }
        .phase-warmup { background: linear-gradient(90deg, #d5f4e6, #f0f8f0); }
        .phase-trigger { background: linear-gradient(90deg, #ffeaa7, #fff8e1); }
        .phase-outage { background: linear-gradient(90deg, #fab1a0, #fce4ec); }
        .phase-readonly { background: linear-gradient(90deg, #fdcb6e, #fff3e0); }
        .phase-recovery { background: linear-gradient(90deg, #a29bfe, #f3e5f5); }
        .table-container {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”„ Auroraåˆ‡æ¢ç›‘æ§åˆ†ææŠ¥å‘Š</h1>
        
        <div class="summary">
            <h3>ğŸ“Š æµ‹è¯•æ¦‚è§ˆ</h3>
            <p><strong>æµ‹è¯•æ—¶é—´:</strong> 2025-09-18 01:55:53 - 01:57:23 (90ç§’) | <strong>é›†ç¾¤:</strong> aurora-failover-test (MySQL 8.0.mysql_aurora.3.10.0) | <strong>æ€»è®°å½•æ•°:</strong> 1068æ¡</p>
            
            <div class="summary-grid">
                <div class="summary-section">
                    <h4>ğŸ—ï¸ æµ‹è¯•ç¯å¢ƒ</h4>
                    <ul>
                        <li>åŒºåŸŸ: æ–°åŠ å¡ (ap-southeast-1)</li>
                        <li>å ¡å’æœº: EC2 r7g.large (ARM64)</li>
                        <li>Auroraé›†ç¾¤: 2ä¸ªr7g.2xlargeå®ä¾‹</li>
                        <li>ç½‘ç»œ: åŒAZéƒ¨ç½²ï¼Œå‡å°‘ç½‘ç»œå»¶è¿Ÿ</li>
                    </ul>
                </div>
                
                <div class="summary-section">
                    <h4>ğŸ” æ¢é’ˆè®¾è®¡</h4>
                    <ul>
                        <li>MySQLè¯»: SELECTæŸ¥è¯¢å¿ƒè·³è¡¨</li>
                        <li>MySQLå†™: INSERTå¿ƒè·³è®°å½•+COMMIT</li>
                        <li>DNSè§£æ: dig cluster endpoint</li>
                        <li>ç›‘æ§é—´éš”: 500msé«˜é¢‘é‡‡æ ·</li>
                    </ul>
                </div>
                
                <div class="summary-section">
                    <h4>â±ï¸ è¶…æ—¶è®¾ç½®</h4>
                    <ul>
                        <li>MySQLè¯»åŸºçº¿: 50ms (è¶…æ—¶100ms)</li>
                        <li>MySQLå†™åŸºçº¿: 100ms (è¶…æ—¶200ms)</li>
                        <li>DNSåŸºçº¿: 100ms (è¶…æ—¶200ms)</li>
                        <li>è¿æ¥è¶…æ—¶: è¯»1ç§’ï¼Œå†™2ç§’</li>
                    </ul>
                </div>
                
                <div class="summary-section">
                    <h4>ğŸ”„ æµ‹è¯•è¿‡ç¨‹</h4>
                    <ul>
                        <li>é¢„çƒ­30ç§’: å»ºç«‹æ€§èƒ½åŸºçº¿</li>
                        <li>è§¦å‘åˆ‡æ¢: æ‰‹åŠ¨failoverå‘½ä»¤</li>
                        <li>ç›‘æ§60ç§’: æ•è·å®Œæ•´åˆ‡æ¢è¿‡ç¨‹</li>
                        <li>è‡ªåŠ¨åœæ­¢: ç”Ÿæˆåˆ†ææŠ¥å‘Š</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="metrics">
            <div class="metric">
                <div class="metric-value">20ç§’</div>
                <div class="metric-label">æ€»åˆ‡æ¢æ—¶é—´</div>
            </div>
            <div class="metric">
                <div class="metric-value">8ç§’</div>
                <div class="metric-label">è¯»æ“ä½œä¸­æ–­</div>
            </div>
            <div class="metric">
                <div class="metric-value">15ç§’</div>
                <div class="metric-label">å†™æ“ä½œä¸­æ–­</div>
            </div>
            <div class="metric">
                <div class="metric-value">ç¬æ—¶</div>
                <div class="metric-label">DNSåˆ‡æ¢æ—¶é—´</div>
            </div>
        </div>

        <h2>ğŸ“ˆ æ—¶é—´åºåˆ—åˆ†æ</h2>
        <div id="timeSeriesChart" class="chart-container">
            <div class="loading">æ­£åœ¨åŠ è½½å›¾è¡¨...</div>
        </div>

        <h2>ğŸ“‹ è¯¦ç»†äº‹ä»¶æ—¥å¿—</h2>
        <div class="table-container">
            <table id="eventTable">
                <thead>
                    <tr>
                        <th>æ—¶é—´æˆ³</th>
                        <th>ä¸»çº¿æ“ä½œ</th>
                        <th>DNSæ¢é’ˆ & IP</th>
                        <th>MySQLè¯»æ¢é’ˆ</th>
                        <th>MySQLå†™æ¢é’ˆ</th>
                    </tr>
                </thead>
                <tbody id="eventTableBody">
                </tbody>
            </table>
        </div>
        
        <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px; border-left: 4px solid #3498db;">
            <h3 style="color: #2c3e50; margin-top: 0;">ğŸ’¡ å…³é”®å‘ç°</h3>
            <ul style="color: #34495e;">
                <li><strong>åªè¯»æ¨¡å¼æœŸ (01:56:36-01:56:42):</strong> è¿æ¥æ¢å¤ä½†å†™æ“ä½œè¿”å› "Running in read-only mode" é”™è¯¯</li>
                <li><strong>DNSåˆ‡æ¢æ—¶æœº:</strong> ä¸å†™æ“ä½œå®Œå…¨æ¢å¤åŒæ­¥å‘ç”Ÿ (01:56:43)</li>
                <li><strong>åˆ‡æ¢æ¨¡å¼:</strong> è¿æ¥ä¸­æ–­ â†’ åªè¯»æ¨¡å¼ â†’ å®Œå…¨æ¢å¤ï¼Œæ¸è¿›å¼æ¢å¤</li>
                <li><strong>åº”ç”¨å±‚å½±å“:</strong> éœ€è¦å¤„ç†15ç§’çš„å†™æ“ä½œä¸å¯ç”¨çª—å£</li>
            </ul>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                if (typeof echarts === 'undefined') {
                    document.getElementById('timeSeriesChart').innerHTML = 
                        '<div style="text-align:center;padding:50px;color:#e74c3c;font-size:16px;">' +
                        'âš ï¸ EChartsåŠ è½½å¤±è´¥<br><small>è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–åˆ·æ–°é¡µé¢é‡è¯•</small></div>';
                    return;
                }
                initChart();
            }, 1000);
        });

        function initChart() {
            const realData = {
                times: [],
                dnsStatus: [],
                readStatus: [],
                writeStatus: []
            };

            const startTime = new Date('2025-09-18T01:55:53');
            const endTime = new Date('2025-09-18T01:57:23');
            
            for (let time = new Date(startTime); time <= endTime; time.setSeconds(time.getSeconds() + 1)) {
                const timeStr = time.toTimeString().substring(0, 8);
                realData.times.push(timeStr);
                
                if (time < new Date('2025-09-18T01:56:23')) {
                    // é¢„çƒ­é˜¶æ®µ
                    realData.dnsStatus.push(1);
                    realData.readStatus.push(1);
                    realData.writeStatus.push(1);
                } else if (time < new Date('2025-09-18T01:56:28')) {
                    // åˆ‡æ¢è§¦å‘
                    realData.dnsStatus.push(1);
                    realData.readStatus.push(1);
                    realData.writeStatus.push(1);
                } else if (time < new Date('2025-09-18T01:56:36')) {
                    // è¿æ¥ä¸­æ–­æœŸ
                    realData.dnsStatus.push(1);
                    realData.readStatus.push(0);
                    realData.writeStatus.push(0);
                } else if (time < new Date('2025-09-18T01:56:43')) {
                    // åªè¯»æ¨¡å¼æœŸ
                    realData.dnsStatus.push(1);
                    realData.readStatus.push(1);
                    realData.writeStatus.push(0.5); // åªè¯»æ¨¡å¼
                } else {
                    // å®Œå…¨æ¢å¤æœŸ
                    realData.dnsStatus.push(1);
                    realData.readStatus.push(1);
                    realData.writeStatus.push(1);
                }
            }

            const chart = echarts.init(document.getElementById('timeSeriesChart'));
            
            const option = {
                title: {
                    text: 'Auroraåˆ‡æ¢è¿‡ç¨‹å®æ—¶ç›‘æ§',
                    subtext: 'åŸºäºçœŸå®æµ‹è¯•æ•°æ® (1ç§’é—´éš”)',
                    left: 'center',
                    textStyle: {
                        fontSize: 18,
                        fontWeight: 'bold'
                    }
                },
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(50,50,50,0.9)',
                    textStyle: {
                        color: '#fff'
                    },
                    formatter: function(params) {
                        let result = '<strong>' + params[0].name + '</strong><br/>';
                        
                        params.forEach(param => {
                            let status = '';
                            let color = '';
                            if (param.seriesName.includes('DNS')) {
                                status = param.value === 1 ? 'æ­£å¸¸' : 'å¤±è´¥';
                                color = param.value === 1 ? '#27ae60' : '#e74c3c';
                            } else if (param.seriesName.includes('è¯»')) {
                                status = param.value === 1 ? 'æ­£å¸¸' : 'å¤±è´¥';
                                color = param.value === 1 ? '#27ae60' : '#e74c3c';
                            } else {
                                status = param.value === 1 ? 'æ­£å¸¸' : param.value === 0.5 ? 'åªè¯»æ¨¡å¼' : 'å¤±è´¥';
                                color = param.value === 1 ? '#27ae60' : param.value === 0.5 ? '#f39c12' : '#e74c3c';
                            }
                            result += '<span style="color:' + color + '">â— ' + param.seriesName + ': ' + status + '</span><br/>';
                        });
                        return result;
                    }
                },
                legend: {
                    data: ['DNSè§£æ', 'MySQLè¯»', 'MySQLå†™'],
                    top: 50,
                    textStyle: {
                        fontSize: 12
                    }
                },
                grid: {
                    left: '5%',
                    right: '5%',
                    bottom: '15%',
                    top: '20%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: realData.times,
                    axisLabel: {
                        interval: 5,
                        rotate: 45,
                        fontSize: 10
                    },
                    axisLine: {
                        lineStyle: {
                            color: '#666'
                        }
                    }
                },
                yAxis: {
                    type: 'value',
                    min: 0,
                    max: 1,
                    axisLabel: {
                        formatter: function(value) {
                            if (value === 1) return 'æ­£å¸¸';
                            if (value === 0.5) return 'åªè¯»';
                            return 'å¤±è´¥';
                        },
                        fontSize: 10
                    },
                    axisLine: {
                        lineStyle: {
                            color: '#666'
                        }
                    },
                    splitLine: {
                        lineStyle: {
                            color: '#eee'
                        }
                    }
                },
                series: [
                    {
                        name: 'DNSè§£æ',
                        type: 'line',
                        data: realData.dnsStatus,
                        itemStyle: { color: '#3498db' },
                        lineStyle: { width: 3 },
                        symbol: 'circle',
                        symbolSize: 6,
                        smooth: true,
                        markLine: {
                            data: [
                                {
                                    name: 'åˆ‡æ¢è§¦å‘',
                                    xAxis: '01:56:23',
                                    lineStyle: { color: '#f39c12', width: 2, type: 'dashed' },
                                    label: { formatter: 'åˆ‡æ¢è§¦å‘', position: 'end' }
                                },
                                {
                                    name: 'DNSåˆ‡æ¢',
                                    xAxis: '01:56:43',
                                    lineStyle: { color: '#9b59b6', width: 2, type: 'dashed' },
                                    label: { formatter: 'DNSåˆ‡æ¢', position: 'end' }
                                }
                            ]
                        }
                    },
                    {
                        name: 'MySQLè¯»',
                        type: 'line',
                        data: realData.readStatus,
                        itemStyle: { color: '#27ae60' },
                        lineStyle: { width: 3 },
                        symbol: 'circle',
                        symbolSize: 6,
                        smooth: true
                    },
                    {
                        name: 'MySQLå†™',
                        type: 'line',
                        data: realData.writeStatus,
                        itemStyle: { color: '#e74c3c' },
                        lineStyle: { width: 3 },
                        symbol: 'circle',
                        symbolSize: 6,
                        smooth: true
                    }
                ]
            };

            chart.setOption(option);
            window.addEventListener('resize', function() {
                chart.resize();
            });
        }

        // ç”Ÿæˆè¯¦ç»†äº‹ä»¶è¡¨æ ¼
        const eventTableData = [
            { time: '01:55:53', phase: 'é¢„çƒ­å¼€å§‹', dns: 'æ­£å¸¸ (10.0.1.215)', read: 'æ­£å¸¸ (~2ms)', write: 'æ­£å¸¸ (~3ms)' },
            { time: '01:56:23', phase: 'åˆ‡æ¢è§¦å‘', dns: 'æ­£å¸¸ (10.0.1.215)', read: 'æ­£å¸¸ (~2ms)', write: 'æ­£å¸¸ (~3ms)' },
            { time: '01:56:28', phase: 'è¿æ¥ä¸­æ–­', dns: 'æ­£å¸¸ (10.0.1.215)', read: 'è¿æ¥æ‹’ç»', write: 'è¿æ¥æ‹’ç»' },
            { time: '01:56:30', phase: 'è¿æ¥ä¸­æ–­', dns: 'æ­£å¸¸ (10.0.1.215)', read: 'è¿æ¥æ‹’ç»', write: 'è¿æ¥æ‹’ç»' },
            { time: '01:56:32', phase: 'è¿æ¥ä¸­æ–­', dns: 'æ­£å¸¸ (10.0.1.215)', read: 'è¿æ¥æ‹’ç»', write: 'è¿æ¥æ‹’ç»' },
            { time: '01:56:34', phase: 'è¿æ¥ä¸­æ–­', dns: 'æ­£å¸¸ (10.0.1.215)', read: 'è¿æ¥æ‹’ç»', write: 'è¿æ¥æ‹’ç»' },
            { time: '01:56:36', phase: 'è¯»æ¢å¤', dns: 'æ­£å¸¸ (10.0.1.215)', read: 'æ¢å¤ (~18ms)', write: 'åªè¯»æ¨¡å¼ (1836é”™è¯¯)' },
            { time: '01:56:38', phase: 'åªè¯»æ¨¡å¼', dns: 'æ­£å¸¸ (10.0.1.215)', read: 'æ­£å¸¸ (~2ms)', write: 'åªè¯»æ¨¡å¼ (1836é”™è¯¯)' },
            { time: '01:56:40', phase: 'åªè¯»æ¨¡å¼', dns: 'æ­£å¸¸ (10.0.1.215)', read: 'æ­£å¸¸ (~2ms)', write: 'åªè¯»æ¨¡å¼ (1836é”™è¯¯)' },
            { time: '01:56:42', phase: 'åªè¯»æ¨¡å¼', dns: 'æ­£å¸¸ (10.0.1.215)', read: 'æ­£å¸¸ (~2ms)', write: 'åªè¯»æ¨¡å¼ (1836é”™è¯¯)' },
            { time: '01:56:43', phase: 'å†™æ¢å¤+DNSåˆ‡æ¢', dns: 'IPå˜åŒ–â†’10.0.1.178', read: 'æ­£å¸¸ (~2ms)', write: 'æ¢å¤ (~13ms)' },
            { time: '01:56:45', phase: 'å®Œå…¨æ¢å¤', dns: 'æ­£å¸¸ (10.0.1.178)', read: 'æ­£å¸¸ (~2ms)', write: 'æ­£å¸¸ (~3ms)' },
            { time: '01:57:00', phase: 'å®Œå…¨æ¢å¤', dns: 'æ­£å¸¸ (10.0.1.178)', read: 'æ­£å¸¸ (~2ms)', write: 'æ­£å¸¸ (~3ms)' },
            { time: '01:57:23', phase: 'ç›‘æ§ç»“æŸ', dns: 'æ­£å¸¸ (10.0.1.178)', read: 'æ­£å¸¸ (~2ms)', write: 'æ­£å¸¸ (~3ms)' }
        ];

        const tableBody = document.getElementById('eventTableBody');
        eventTableData.forEach(row => {
            const tr = document.createElement('tr');
            
            if (row.phase.includes('é¢„çƒ­')) tr.className = 'phase-warmup';
            else if (row.phase.includes('åˆ‡æ¢') || row.phase.includes('è§¦å‘')) tr.className = 'phase-trigger';
            else if (row.phase.includes('ä¸­æ–­')) tr.className = 'phase-outage';
            else if (row.phase.includes('åªè¯»') || row.phase.includes('è¯»æ¢å¤')) tr.className = 'phase-readonly';
            else if (row.phase.includes('æ¢å¤') || row.phase.includes('DNS')) tr.className = 'phase-recovery';
            
            tr.innerHTML = `
                <td><strong>${row.time}</strong></td>
                <td><strong>${row.phase}</strong></td>
                <td class="${row.dns.includes('å˜åŒ–') ? 'status-warning' : 'status-success'}">${row.dns}</td>
                <td class="${row.read.includes('æ‹’ç»') ? 'status-error' : row.read.includes('18ms') ? 'status-warning' : 'status-success'}">${row.read}</td>
                <td class="${row.write.includes('æ‹’ç»') ? 'status-error' : row.write.includes('åªè¯»') ? 'status-warning' : row.write.includes('13ms') ? 'status-warning' : 'status-success'}">${row.write}</td>
            `;
            tableBody.appendChild(tr);
        });
    </script>
</body>
</html>
